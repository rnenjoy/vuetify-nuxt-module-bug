{"version":3,"file":"utils.js","sources":["../../../src/runtime/utils.ts"],"sourcesContent":["import { getActiveSpan, getRootSpan, spanToTraceHeader } from '@sentry/core';\nimport { getDynamicSamplingContextFromSpan } from '@sentry/opentelemetry';\nimport type { Context } from '@sentry/types';\nimport { dropUndefinedKeys } from '@sentry/utils';\nimport { dynamicSamplingContextToSentryBaggageHeader } from '@sentry/utils';\nimport type { CapturedErrorContext } from 'nitropack';\nimport type { NuxtRenderHTMLContext } from 'nuxt/app';\n\n/**\n *  Extracts the relevant context information from the error context (H3Event in Nitro Error)\n *  and created a structured context object.\n */\nexport function extractErrorContext(errorContext: CapturedErrorContext): Context {\n  const structuredContext: Context = {\n    method: undefined,\n    path: undefined,\n    tags: undefined,\n  };\n\n  if (errorContext) {\n    if (errorContext.event) {\n      structuredContext.method = errorContext.event._method || undefined;\n      structuredContext.path = errorContext.event._path || undefined;\n    }\n\n    if (Array.isArray(errorContext.tags)) {\n      structuredContext.tags = errorContext.tags || undefined;\n    }\n  }\n\n  return dropUndefinedKeys(structuredContext);\n}\n\n/**\n * Adds Sentry tracing <meta> tags to the returned html page.\n *\n * Exported only for testing\n */\nexport function addSentryTracingMetaTags(head: NuxtRenderHTMLContext['head']): void {\n  const activeSpan = getActiveSpan();\n  const rootSpan = activeSpan ? getRootSpan(activeSpan) : undefined;\n\n  if (rootSpan) {\n    const traceParentData = spanToTraceHeader(rootSpan);\n    const dynamicSamplingContext = dynamicSamplingContextToSentryBaggageHeader(\n      getDynamicSamplingContextFromSpan(rootSpan),\n    );\n\n    head.push(`<meta name=\"sentry-trace\" content=\"${traceParentData}\"/>`);\n    head.push(`<meta name=\"baggage\" content=\"${dynamicSamplingContext}\"/>`);\n  }\n}\n"],"names":[],"mappings":";;;;AAQA;AACA;AACA;AACA;AACO,SAAS,mBAAmB,CAAC,YAAY,EAAiC;AACjF,EAAE,MAAM,iBAAiB,GAAY;AACrC,IAAI,MAAM,EAAE,SAAS;AACrB,IAAI,IAAI,EAAE,SAAS;AACnB,IAAI,IAAI,EAAE,SAAS;AACnB,GAAG,CAAA;AACH;AACA,EAAE,IAAI,YAAY,EAAE;AACpB,IAAI,IAAI,YAAY,CAAC,KAAK,EAAE;AAC5B,MAAM,iBAAiB,CAAC,MAAA,GAAS,YAAY,CAAC,KAAK,CAAC,OAAQ,IAAG,SAAS,CAAA;AACxE,MAAM,iBAAiB,CAAC,IAAA,GAAO,YAAY,CAAC,KAAK,CAAC,KAAM,IAAG,SAAS,CAAA;AACpE,KAAI;AACJ;AACA,IAAI,IAAI,KAAK,CAAC,OAAO,CAAC,YAAY,CAAC,IAAI,CAAC,EAAE;AAC1C,MAAM,iBAAiB,CAAC,IAAK,GAAE,YAAY,CAAC,IAAA,IAAQ,SAAS,CAAA;AAC7D,KAAI;AACJ,GAAE;AACF;AACA,EAAE,OAAO,iBAAiB,CAAC,iBAAiB,CAAC,CAAA;AAC7C,CAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACO,SAAS,wBAAwB,CAAC,IAAI,EAAuC;AACpF,EAAE,MAAM,UAAA,GAAa,aAAa,EAAE,CAAA;AACpC,EAAE,MAAM,QAAS,GAAE,UAAW,GAAE,WAAW,CAAC,UAAU,CAAE,GAAE,SAAS,CAAA;AACnE;AACA,EAAE,IAAI,QAAQ,EAAE;AAChB,IAAI,MAAM,eAAgB,GAAE,iBAAiB,CAAC,QAAQ,CAAC,CAAA;AACvD,IAAI,MAAM,sBAAuB,GAAE,2CAA2C;AAC9E,MAAM,iCAAiC,CAAC,QAAQ,CAAC;AACjD,KAAK,CAAA;AACL;AACA,IAAI,IAAI,CAAC,IAAI,CAAC,CAAC,mCAAmC,EAAE,eAAe,CAAC,GAAG,CAAC,CAAC,CAAA;AACzE,IAAI,IAAI,CAAC,IAAI,CAAC,CAAC,8BAA8B,EAAE,sBAAsB,CAAC,GAAG,CAAC,CAAC,CAAA;AAC3E,GAAE;AACF;;;;"}
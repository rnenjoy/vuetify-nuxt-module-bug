Object.defineProperty(exports, '__esModule', { value: true });

const core = require('@sentry/core');
const opentelemetry = require('@sentry/opentelemetry');
const utils = require('@sentry/utils');

/**
 *  Extracts the relevant context information from the error context (H3Event in Nitro Error)
 *  and created a structured context object.
 */
function extractErrorContext(errorContext) {
  const structuredContext = {
    method: undefined,
    path: undefined,
    tags: undefined,
  };

  if (errorContext) {
    if (errorContext.event) {
      structuredContext.method = errorContext.event._method || undefined;
      structuredContext.path = errorContext.event._path || undefined;
    }

    if (Array.isArray(errorContext.tags)) {
      structuredContext.tags = errorContext.tags || undefined;
    }
  }

  return utils.dropUndefinedKeys(structuredContext);
}

/**
 * Adds Sentry tracing <meta> tags to the returned html page.
 *
 * Exported only for testing
 */
function addSentryTracingMetaTags(head) {
  const activeSpan = core.getActiveSpan();
  const rootSpan = activeSpan ? core.getRootSpan(activeSpan) : undefined;

  if (rootSpan) {
    const traceParentData = core.spanToTraceHeader(rootSpan);
    const dynamicSamplingContext = utils.dynamicSamplingContextToSentryBaggageHeader(
      opentelemetry.getDynamicSamplingContextFromSpan(rootSpan),
    );

    head.push(`<meta name="sentry-trace" content="${traceParentData}"/>`);
    head.push(`<meta name="baggage" content="${dynamicSamplingContext}"/>`);
  }
}

exports.addSentryTracingMetaTags = addSentryTracingMetaTags;
exports.extractErrorContext = extractErrorContext;
//# sourceMappingURL=utils.js.map

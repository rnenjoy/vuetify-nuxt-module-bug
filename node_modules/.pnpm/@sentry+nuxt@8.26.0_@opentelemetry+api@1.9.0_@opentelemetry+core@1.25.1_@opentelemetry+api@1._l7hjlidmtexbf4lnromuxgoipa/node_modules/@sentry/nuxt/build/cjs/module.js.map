{"version":3,"file":"module.js","sources":["../../src/module.ts"],"sourcesContent":["import * as fs from 'fs';\nimport * as path from 'path';\nimport { addPlugin, addPluginTemplate, addServerPlugin, createResolver, defineNuxtModule } from '@nuxt/kit';\nimport type { SentryNuxtModuleOptions } from './common/types';\nimport { setupSourceMaps } from './vite/sourceMaps';\n\nexport type ModuleOptions = SentryNuxtModuleOptions;\n\nexport default defineNuxtModule<ModuleOptions>({\n  meta: {\n    name: '@sentry/nuxt/module',\n    configKey: 'sentry',\n    compatibility: {\n      nuxt: '^3.0.0',\n    },\n  },\n  defaults: {},\n  setup(moduleOptions, nuxt) {\n    const moduleDirResolver = createResolver(import.meta.url);\n    const buildDirResolver = createResolver(nuxt.options.buildDir);\n\n    const clientConfigFile = findDefaultSdkInitFile('client');\n\n    if (clientConfigFile) {\n      // Inject the client-side Sentry config file with a side effect import\n      addPluginTemplate({\n        mode: 'client',\n        filename: 'sentry-client-config.mjs',\n        getContents: () =>\n          `import \"${buildDirResolver.resolve(`/${clientConfigFile}`)}\"\\n` +\n          'import { defineNuxtPlugin } from \"#imports\"\\n' +\n          'export default defineNuxtPlugin(() => {})',\n      });\n\n      addPlugin({ src: moduleDirResolver.resolve('./runtime/plugins/sentry.client'), mode: 'client' });\n    }\n\n    const serverConfigFile = findDefaultSdkInitFile('server');\n\n    if (serverConfigFile) {\n      // Inject the server-side Sentry config file with a side effect import\n      addPluginTemplate({\n        mode: 'server',\n        filename: 'sentry-server-config.mjs',\n        getContents: () =>\n          `import \"${buildDirResolver.resolve(`/${serverConfigFile}`)}\"\\n` +\n          'import { defineNuxtPlugin } from \"#imports\"\\n' +\n          'export default defineNuxtPlugin(() => {})',\n      });\n\n      addServerPlugin(moduleDirResolver.resolve('./runtime/plugins/sentry.server'));\n    }\n\n    if (clientConfigFile || serverConfigFile) {\n      setupSourceMaps(moduleOptions, nuxt);\n    }\n  },\n});\n\nfunction findDefaultSdkInitFile(type: 'server' | 'client'): string | undefined {\n  const possibleFileExtensions = ['ts', 'js', 'mjs', 'cjs', 'mts', 'cts'];\n\n  const cwd = process.cwd();\n  const filePath = possibleFileExtensions\n    .map(e =>\n      path.resolve(\n        type === 'server'\n          ? path.join(cwd, 'public', `instrument.${type}.${e}`)\n          : path.join(cwd, `sentry.${type}.config.${e}`),\n      ),\n    )\n    .find(filename => fs.existsSync(filename));\n\n  return filePath ? path.basename(filePath) : undefined;\n}\n"],"names":["defineNuxtModule","createResolver","addPluginTemplate","addPlugin","addServerPlugin","setupSourceMaps"],"mappings":"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"}